 

<!DOCTYPE html>
<html>
    <head>
        <title>Car | RideJoy</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Bootstrap Css -->
        <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">        
        <!-- Bootstrap Select Css -->
        <link rel="stylesheet" type="text/css" href="assets/css/bootstrap-select.min.css">
        <!-- Fonts Css -->
        <link rel="stylesheet" type="text/css" href="assets/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="assets/css/elegant.css">
        <!-- OwlCarousel2 Slider Css -->
        <link rel="stylesheet" type="text/css" href="assets/css/owl.carousel.css">


        <!-- Animate Css -->       
        <link rel="stylesheet" type="text/css" href="assets/css/animate.css">

        <!-- Main Css -->
        <link rel="stylesheet" type="text/css" href="assets/css/theme.css">

        <!--[if lt IE 9]>
        <script src="assets/plugins/iesupport/html5shiv.js"></script>
        <script src="assets/plugins/iesupport/respond.js"></script>
        <![endif]-->
    </head>
 

<body>
    <!-- Main Wrapper -->        
        <main class="wrapper">
 
            <!-- Header -->
            <header class="header-main">

                <!-- Header Topbar -->
                <div class="top-bar font2-title1 white-clr">
                    <div class="theme-container container">
                        <div class="row">
                            <div class="col-md-6 col-sm-5">
                                <ul class="list-items fs-10">
                                    <li><a href="#"></a></li>
                                    <li class="active"><a href="#">Privacy</a></li>
                                    <li><a href="#"></a></li>
                                </ul>
                            </div>
                            <div class="col-md-6 col-sm-7 fs-12">
                                <p class="contact-num">  <i class="fa fa-phone"></i> Call us now: <span class="theme-clr"> +880 1985887839 </span> </p>
                            </div>
                        </div>
                    </div>


                    <div id="navbar" class="collapse navbar-collapse no-pad">
                                    <ul class="navbar-nav ">

                                        <li class="dropdown sign-in fs-12 theme-clr-bg">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" >Sign in </a>
                                            <ul class="dropdown-menu">
                                                <li><a href="login.html">User</a></li>
                                                <li><a href="login.html">Rider</a></li>

                                            </ul>
                                        </li>
                                    </ul>
                            </div>
                </div>
                <!-- /.Header Topbar -->

                <!-- Header Logo & Navigation -->
                <nav class="menu-bar font2-title1">
                    <div class="theme-container container">
                        <div class="row">
                            <div class="col-md-2 col-sm-2">
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-controls="navbar">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                                <a class="navbar-logo" href="#"> <img src="assets/img/logo/logo_header.png" alt="logo" /> </a>
                            </div>
                            <div class="col-md-10 col-sm-10 fs-12">
                                <div id="navbar" class="collapse navbar-collapse no-pad">
                                    <ul class="navbar-nav theme-menu">

                                         <li class="active"> <a href="index.html">Home</a> </li>

                                        

                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" >Services </a>
                                            <ul class="dropdown-menu">
                                                <li><a href="bike.html">Bike</a></li>
                                                 <li><a href="car.html">Car</a></li>
                                            </ul>
                                        </li>
                                       
                                        <li> <a href="contact.html"> contact </a> </li>

                                        <li> 
                                            <a href="Pendingrides.html"> Pending Rides</a> 
                                        </li> 
                                         
                                        
                                        <li><span class=""> </span></li>
                                    </ul>                                                      
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
                <!-- /.Header Logo & Navigation -->

            </header>
            <!-- /.Header -->

         <!-- Content Wrapper -->
 
 
<center>
  <button onclick="confirm()" id="trip-button" disabled class="btn btn-info">Confirm Trip</button>

</center>
<br>
 
<center>or
  <h4>Please Login To continue</h4>
</center>
 
<center>
  <h4 id="distance">

  </h4>
</center>
<input
      id="pac-input"
      class="controls"
      style="margin-left:250px;width:350px;height:30px"
      type="text"
      placeholder="Pickup Point"
    />
    <input
      id="pac-input2"
      class="controls"
      style="margin-left:250px;width:350px;height:30px"
      type="text"
      placeholder="Destination Point"
    />
<div style="height:400px;padding:20px;margin:30px" id="map"></div>






 
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
  var pickupPoint=false;
  var destinationPoint=false;
  function confirm(){
    window.location.href=`{{URL::to('/bike/start-trip')}}?lat1=${pickupPoint.lat}&lon1=${pickupPoint.lng}&lat2=${destinationPoint.lat}&lon2=${destinationPoint.lng}`
  }
  function calcCrow() 
    {
      lat1=pickupPoint.lat
      lon1=pickupPoint.lng;
      lat2=destinationPoint.lat
      lon2=destinationPoint.lng
      var R = 6371; // km
      var dLat = toRad(lat2-lat1);
      var dLon = toRad(lon2-lon1);
      var lat1 = toRad(lat1);
      var lat2 = toRad(lat2);

      var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = R * c;
      return d.toFixed(2);
    }

    // Converts numeric degrees to radians
    function toRad(Value) 
    {
        return Value * Math.PI / 180;
    }
  function updateDistance(){
    if(destinationPoint){
      document.getElementById("distance").innerHTML="Trip distance "+calcCrow()+" KM"+"<br/>Total Cost "+Math.floor(calcCrow()*12)+"TK"; 
    }
  }
    function initMap(position) {
      const myLatlng = { lat: position.coords.latitude , lng: position.coords.longitude };
      pickupPoint={
        lat: position.coords.latitude,
        lng: position.coords.longitude
      }
      const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: myLatlng,
      });
      const input = document.getElementById("pac-input");
      const input2 = document.getElementById("pac-input2");
      const searchBox = new google.maps.places.SearchBox(input);
      const searchBox2 = new google.maps.places.SearchBox(input2);
      map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
      map.controls[google.maps.ControlPosition.TOP_RIGHT].push(input2);
  // Bias the SearchBox results towards current map's viewport.
  map.addListener("bounds_changed", () => {
    searchBox.setBounds(map.getBounds());
  });
  map.addListener("bounds_changed", () => {
    searchBox2.setBounds(map.getBounds());
  });
  let markers = [];
  // Listen for the event fired when the user selects a prediction and retrieve
  // more details for that place.
  searchBox.addListener("places_changed", () => {
    const places = searchBox.getPlaces();

    if (places.length == 0) {
      return;
    }
    // Clear out the old markers.
    markers.forEach((marker) => {
      marker.setMap(null);
    });
    markers = [];
    // For each place, get the icon, name and location.
    const bounds = new google.maps.LatLngBounds();
    places.forEach((place) => {
      if (!place.geometry) {
        console.log("Returned place contains no geometry");
        return;
      }
      const icon = {
        url: place.icon,
        size: new google.maps.Size(71, 71),
        origin: new google.maps.Point(0, 0),
        anchor: new google.maps.Point(17, 34),
        scaledSize: new google.maps.Size(25, 25),
      };
      // Create a marker for each place.
      markers.push(
        new google.maps.Marker({
          map,
          icon,
          title: place.name,
          position: place.geometry.location,
        })
      );
     // console.log(place.geometry.location.lat());

     pickupPoint={
            lat:place.geometry.location.lat(),
            lng:place.geometry.location.lng()
          };
         // console.log(mapsMouseEvent.latLng.lat())
       
          
          pickupWindow.close();
          pickupWindow = new google.maps.InfoWindow({
          position: place.geometry.location,
          });
          pickupWindow.setContent(
            "Pickup Point"
          // JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
          );
          pickupWindow.open(map);
          updateDistance()
          if(destinationPoint){
            
            display.setMap(map);
        var start = new google.maps.LatLng(pickupPoint.lat,pickupPoint.lng);
        var end = new google.maps.LatLng(destinationPoint.lat,destinationPoint.lng);
          var request ={
                origin : start,
                destination:end,
                travelMode: 'DRIVING'
            };
            services.route(request,function(result,status){
                if(status =='OK'){
                    display.setDirections(result);
                }
            });
          }
        



      if (place.geometry.viewport) {
        // Only geocodes have viewport.
        bounds.union(place.geometry.viewport);
      } else {
        bounds.extend(place.geometry.location);
      }
    });
    map.fitBounds(bounds);
  });


  searchBox2.addListener("places_changed", () => {
    document.getElementById("trip-button").disabled=false;
    const places = searchBox2.getPlaces();

    if (places.length == 0) {
      return;
    }
    // Clear out the old markers.
    markers.forEach((marker) => {
      marker.setMap(null);
    });
    markers = [];
    // For each place, get the icon, name and location.
    const bounds = new google.maps.LatLngBounds();
    places.forEach((place) => {
      if (!place.geometry) {
        console.log("Returned place contains no geometry");
        return;
      }
      const icon = {
        url: place.icon,
        size: new google.maps.Size(71, 71),
        origin: new google.maps.Point(0, 0),
        anchor: new google.maps.Point(17, 34),
        scaledSize: new google.maps.Size(25, 25),
      };
      // Create a marker for each place.
      markers.push(
        new google.maps.Marker({
          map,
          icon,
          title: place.name,
          position: place.geometry.location,
        })
      );
     // console.log(place.geometry.location.lat());

     destinationPoint={
            lat:place.geometry.location.lat(),
            lng:place.geometry.location.lng()
          };
         // console.log(mapsMouseEvent.latLng.lat())
       
          
         if(typeof destinationWindow !== 'undefined'){
            destinationWindow.close();
          }
          destinationWindow = new google.maps.InfoWindow({
          position: place.geometry.location,
          });
          destinationWindow.setContent(
            "Destination Point"
          // JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
          );
          destinationWindow.open(map);
          updateDistance()
          if(destinationPoint){
            display.setMap(map);
        var start = new google.maps.LatLng(pickupPoint.lat,pickupPoint.lng);
        var end = new google.maps.LatLng(destinationPoint.lat,destinationPoint.lng);
          var request ={
                origin : start,
                destination:end,
                travelMode: 'DRIVING'
            };
            services.route(request,function(result,status){
                if(status =='OK'){
                    display.setDirections(result);
                }
            });
          }
        



      if (place.geometry.viewport) {
        // Only geocodes have viewport.
        bounds.union(place.geometry.viewport);
      } else {
        bounds.extend(place.geometry.location);
      }
    });
    map.fitBounds(bounds);
  });


      var display = new google.maps.DirectionsRenderer();
        var services = new google.maps.DirectionsService();
      map.setMapTypeId(google.maps.MapTypeId.HYBRID);
      // Create the initial InfoWindow.
      let pickupWindow = new google.maps.InfoWindow({
          content: "Pickup Point",
          position: myLatlng,
      });
      pickupWindow.open(map);
      // Configure the click listener.
      map.addListener("click", (mapsMouseEvent) => {
        Swal.fire({
        title: 'Confirm Pickup/destination.',
        showDenyButton: true,
        showCancelButton: true,
        confirmButtonText: `Pickup Point`,
        denyButtonText: `Destination Point`,
      }).then((result) => {
        /* Read more about isConfirmed, isDenied below */
        if (result.isConfirmed) {
          pickupPoint={
            lat:mapsMouseEvent.latLng.lat(),
            lng:mapsMouseEvent.latLng.lng()
          };
         // console.log(mapsMouseEvent.latLng.lat())
       
          
          pickupWindow.close();
          pickupWindow = new google.maps.InfoWindow({
          position: mapsMouseEvent.latLng,
          });
          pickupWindow.setContent(
            "Pickup Point"
          // JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
          );
          pickupWindow.open(map);
          updateDistance()
          if(destinationPoint){
            display.setMap(map);
        var start = new google.maps.LatLng(pickupPoint.lat,pickupPoint.lng);
        var end = new google.maps.LatLng(destinationPoint.lat,destinationPoint.lng);
          var request ={
                origin : start,
                destination:end,
                travelMode: 'DRIVING'
            };
            services.route(request,function(result,status){
                if(status =='OK'){
                    display.setDirections(result);
                }
            });
          }
        } else if (result.isDenied) {
          document.getElementById("trip-button").disabled=false;
          destinationPoint={
            lat:mapsMouseEvent.latLng.lat(),
            lng:mapsMouseEvent.latLng.lng()
          };
          if(typeof destinationWindow !== 'undefined'){
            destinationWindow.close();
          }
          destinationWindow = new google.maps.InfoWindow({
          position: mapsMouseEvent.latLng,
          });
          destinationWindow.setContent(
            "Destination Point"
          // JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
          );
          destinationWindow.open(map);
          updateDistance()
          
        
        display.setMap(map);
        var start = new google.maps.LatLng(pickupPoint.lat,pickupPoint.lng);
        var end = new google.maps.LatLng(destinationPoint.lat,destinationPoint.lng);
          var request ={
                origin : start,
                destination:end,
                travelMode: 'DRIVING'
            };
            services.route(request,function(result,status){
                if(status =='OK'){
                    display.setDirections(result);
                }
            });
        }
      })
         
          
      });
      }

  if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(initMap);
} else {
  x.innerHTML = "Geolocation is not supported by this browser.";
}
      function showPosition(position) {
var latlon = position.coords.latitude + "," + position.coords.longitude;

var img_url = "https://maps.googleapis.com/maps/api/staticmap?center="+latlon+"&zoom=14&size=400x300&sensor=false&key=AIzaSyCz2V7sDSQ1u-u2viJJwpMhdWVGotTheC8";

document.getElementById("map").innerHTML = "<img src='"+img_url+"'>";
}
</script>
 



        </main>
        <!-- / Main Wrapper -->


 <!-- JS -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCi82DDWkY-_hwoBcUp84sIcnP8pUx8lLc&callback=initMap&libraries=places&v=weekly"
  defer
></script> 
    <!-- / Search Popup -->

        <!-- Main Jquery JS -->
        <script src="assets/js/jquery-2.2.4.min.js" type="text/javascript"></script>        
        <!-- Bootstrap JS -->
        <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>    
        <!-- Bootstrap Select JS -->
        <script src="assets/js/bootstrap-select.min.js" type="text/javascript"></script>    
        <!-- OwlCarousel2 Slider JS -->
        <script src="assets/js/owl.carousel.min.js" type="text/javascript"></script>   
        <!-- Sticky Header -->
        <script src="assets/js/jquery.sticky.js"></script>
        <!-- Wow JS -->
        <script src="assets/js/wow.min.js" type="text/javascript"></script>
        <!-- Data binder -->
        <script src="assets/js/data.binder.js" type="text/javascript"></script>

        <!-- Slider JS -->        


        <!-- Theme JS -->
        <script src="assets/js/theme.js" type="text/javascript"></script>

    </body>
</html>
